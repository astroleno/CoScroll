# 方案2参数调优指南

## 核心参数位置

所有关键参数都在 `/src/p5/sketch.ts` 的 `p.draw()` 函数中。

## 1. 颜色配置

### 位置: `sketch.ts:151-153`

```typescript
neonShader.setUniform('uMainColor', [0.3, 0.9, 0.5]);      // 绿色中心
neonShader.setUniform('uSecondaryColor', [0.9, 0.7, 0.3]); // 橙色中层
neonShader.setUniform('uRimColor', [0.9, 0.4, 0.8]);       // 紫色边缘
```

**调优建议:**
- 增加中心亮度: `uMainColor: [0.5, 1.0, 0.7]`
- 更冷色调: `uSecondaryColor: [0.7, 0.8, 1.0]`
- 更暖边缘: `uRimColor: [1.0, 0.6, 0.4]`

**快速预设:**
```typescript
// 蓝色梦幻
uMainColor: [0.2, 0.6, 1.0]
uSecondaryColor: [0.4, 0.8, 0.9]
uRimColor: [0.8, 0.9, 1.0]

// 金色华丽
uMainColor: [1.0, 0.8, 0.3]
uSecondaryColor: [1.0, 0.6, 0.2]
uRimColor: [1.0, 0.4, 0.1]

// 紫色神秘
uMainColor: [0.6, 0.3, 1.0]
uSecondaryColor: [0.8, 0.4, 0.9]
uRimColor: [1.0, 0.5, 0.8]
```

## 2. 噪声和动画

### 位置: `sketch.ts:154-156`

```typescript
neonShader.setUniform('uNoiseScale', 2.0);          // 噪声缩放
neonShader.setUniform('uBreathingSpeed', 0.3);      // 呼吸速度
neonShader.setUniform('uFresnelIntensity', 3.0);    // 边缘光强度
```

**效果对比:**

| 参数 | 低值 | 默认 | 高值 | 效果 |
|-----|------|------|------|------|
| `uNoiseScale` | 0.5 | 2.0 | 5.0 | 噪声细腻度 |
| `uBreathingSpeed` | 0.1 | 0.3 | 1.0 | 呼吸快慢 |
| `uFresnelIntensity` | 1.0 | 3.0 | 5.0 | 边缘发光 |

**场景建议:**
- 平静禅意: `noiseScale=0.8, breathingSpeed=0.15`
- 动感活力: `noiseScale=3.5, breathingSpeed=0.8`
- 神秘玄幻: `noiseScale=4.0, fresnelIntensity=5.0`

## 3. 模糊强度

### 位置: `sketch.ts:172-178`

```typescript
applyBlur(haloL0, haloL1, 4.0);  // 第一层
applyBlur(haloL1, haloL2, 6.0);  // 第二层
applyBlur(haloL2, haloL3, 8.0);  // 第三层
```

**调优策略:**

| 需求 | L1 sigma | L2 sigma | L3 sigma | 说明 |
|-----|----------|----------|----------|------|
| **锐利清晰** | 2.0 | 3.0 | 4.0 | 减少模糊，保留细节 |
| **默认平衡** | 4.0 | 6.0 | 8.0 | 当前设置 |
| **极致柔软** | 8.0 | 12.0 | 16.0 | 最大柔边效果 |
| **性能优先** | 3.0 | 4.0 | 5.0 | 降低计算量 |

**注意:** sigma值越大，模糊越强，但GPU开销也越大。

## 4. 合成参数

### 位置: `sketch.ts:189-190`

```typescript
compositeShader.setUniform('uBloomStrength', 0.8);  // 光晕强度
compositeShader.setUniform('uSoftness', 0.6);       // 柔软度
```

**效果调整:**

| 参数 | 范围 | 默认 | 效果 |
|-----|------|------|------|
| `uBloomStrength` | 0.0-2.0 | 0.8 | 控制光晕发光强度 |
| `uSoftness` | 0.0-1.0 | 0.6 | 控制边缘透明度扩散 |

**视觉预设:**
```typescript
// 硬边锐利 (接近原始几何)
uBloomStrength: 0.3
uSoftness: 0.2

// 柔和平衡 (推荐)
uBloomStrength: 0.8
uSoftness: 0.6

// 梦幻发光 (最大柔边)
uBloomStrength: 1.5
uSoftness: 0.9
```

## 5. 旋转速度

### 位置: `sketch.ts:164`

```typescript
haloL0.rotateY(p.millis() / 2000.0); // 缓慢旋转
```

**速度调整:**
- 更慢: `p.millis() / 4000.0` (4秒一圈)
- 默认: `p.millis() / 2000.0` (2秒一圈)
- 更快: `p.millis() / 1000.0` (1秒一圈)
- 静止: 删除此行

## 6. 合成混合权重

### 位置: `composite.frag:18`

```glsl
vec4 softHalo = blur1 * 0.3 + blur2 * 0.4 + blur3 * 0.3;
```

**调整方法:**

修改 `sketch.ts:99` 中的内联shader:

```typescript
// 默认 (平均分布)
blur1*0.3 + blur2*0.4 + blur3*0.3

// 强调近距离柔化
blur1*0.6 + blur2*0.3 + blur3*0.1

// 强调远距离光晕
blur1*0.1 + blur2*0.3 + blur3*0.6

// 极致扩散
blur1*0.2 + blur2*0.2 + blur3*0.6
```

## 实时调优技巧

### 1. 使用浏览器控制台

```javascript
// 在浏览器console中运行
window.__COSCROLL_DEBUG__ = true;

// 查看当前帧率
setInterval(() => console.log('FPS:', Math.round(frameRate())), 1000);
```

### 2. 快速测试预设

创建测试配置数组:

```typescript
const presets = [
  { name: '默认', main: [0.3,0.9,0.5], bloom: 0.8 },
  { name: '蓝色', main: [0.2,0.6,1.0], bloom: 1.0 },
  { name: '金色', main: [1.0,0.8,0.3], bloom: 0.6 },
];

let currentPreset = 0;

// 按键切换 (添加到sketch)
p.keyPressed = () => {
  if (p.key === ' ') {
    currentPreset = (currentPreset + 1) % presets.length;
    console.log('切换到:', presets[currentPreset].name);
  }
};
```

### 3. 性能监控

在 `sketch.ts:draw()` 末尾添加:

```typescript
if (p.frameCount % 60 === 0) {
  console.log('[FPS]', Math.round(p.frameRate()));
  console.log('[Memory]', performance.memory?.usedJSHeapSize / 1024 / 1024 + 'MB');
}
```

## 常见问题调优

### Q1: 边缘太硬，不够柔软

**方案A**: 增加模糊强度
```typescript
applyBlur(haloL0, haloL1, 8.0);  // 原4.0
applyBlur(haloL1, haloL2, 12.0); // 原6.0
applyBlur(haloL2, haloL3, 16.0); // 原8.0
```

**方案B**: 增加柔软度
```typescript
compositeShader.setUniform('uSoftness', 0.9); // 原0.6
```

### Q2: 颜色太暗淡

**方案A**: 提升整体亮度
```typescript
uMainColor: [0.5, 1.0, 0.7]      // 增加各通道值
uSecondaryColor: [1.0, 0.9, 0.5]
```

**方案B**: 增加光晕强度
```typescript
uBloomStrength: 1.2 // 原0.8
```

### Q3: 性能不足，FPS低

**方案A**: 降低模糊强度
```typescript
applyBlur(haloL0, haloL1, 2.0);  // 原4.0
applyBlur(haloL1, haloL2, 3.0);  // 原6.0
applyBlur(haloL2, haloL3, 4.0);  // 原8.0
```

**方案B**: 降低FBO分辨率
```typescript
haloL0 = p.createGraphics(p.width*0.8, p.height*0.8, p.WEBGL);
```

**方案C**: 减少模糊层级
```typescript
// 只使用L0和L1，注释掉L2/L3
vec4 softHalo = blur1 * 1.0; // 单层模糊
```

### Q4: 噪声太明显/太细碎

**太明显 →** 降低 `uNoiseScale: 1.0` (原2.0)
**太细碎 →** 增加 `uNoiseScale: 4.0` (原2.0)

## 推荐工作流

1. **初始设置**: 使用默认参数运行
2. **颜色调整**: 先确定主色调风格
3. **柔软度调整**: 调整模糊和合成参数
4. **细节优化**: 调整噪声和动画速度
5. **性能优化**: 根据目标设备调整
6. **最终测试**: 多设备测试兼容性

---
**提示**: 每次修改后保存文件，浏览器会自动热重载(HMR)，无需手动刷新。

**文档版本**: v1.0
**更新日期**: 2025-09-30