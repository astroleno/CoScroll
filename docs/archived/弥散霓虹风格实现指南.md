# å¼¥æ•£éœ“è™¹é£æ ¼å®ç°æŒ‡å—

> åŸºäº CoScroll MVP æ¡†æ¶çš„"Dreamy Grain Glow"é£æ ¼å…·ä½“å®è·µæ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®å½“å‰çŠ¶æ€åˆ†æ

### âœ… å·²å®Œæˆçš„åŸºç¡€æ¶æ„
- âœ… é¡¹ç›®å·²æˆåŠŸè¿è¡Œåœ¨ `http://localhost:3001`
- âœ… Next.js 14 + TypeScript + Three.js åŸºç¡€æ¡†æ¶
- âœ… `@react-three/postprocessing` å·²å®‰è£… (å¼¥æ•£æ•ˆæœå¿…éœ€)
- âœ… å®Œæ•´çš„ç»„ä»¶æ¶æ„å’ŒçŠ¶æ€ç®¡ç†

### ğŸ”§ éœ€è¦ä¿®å¤çš„æŠ€æœ¯é—®é¢˜
æ ¹æ®æ—¥å¿—åˆ†æï¼Œéœ€è¦ä¼˜å…ˆè§£å†³ï¼š
- ğŸ”„ Tone.js API å¯¼å…¥é”™è¯¯ (tone.start, tone.context ç­‰)
- ğŸ”„ ä¸­æ–‡å­—ä½“æ–‡ä»¶ç¼ºå¤± (`/fonts/chinese-font.woff`)
- ğŸ”„ éŸ³é¢‘åˆå§‹åŒ–é—®é¢˜

### ğŸ¨ è§†è§‰æ•ˆæœç›®æ ‡
åŸºäºå‚è€ƒå›¾ç‰‡å’ŒGPTé£æ ¼å»ºè®®ï¼Œç›®æ ‡å®ç°ï¼š
- **å¼¥æ•£å‘å…‰**: Matcap + Fresnel + Bloom ç»„åˆ
- **éœ“è™¹æ¸å˜**: ç²‰æ©™ (#ff6b9d) â†” é’è“ (#4ecdc4) è¿‡æ¸¡
- **é¢—ç²’è´¨æ„Ÿ**: Film Grain + Dither æ©é¥°ä½æ¨¡ç‘•ç–µ
- **å‘¼å¸åŠ¨æ•ˆ**: æ»šåŠ¨é©±åŠ¨çš„å…‰æ™•å¼ºåº¦å˜åŒ–

### ğŸ¯ å¸ƒå±€æ¶æ„è®¾è®¡
**ä¸‰å±‚åˆ†ç¦»æ¶æ„**ï¼š
1. **åº•å±‚**: èƒŒæ™¯ WebGL (å¼¥æ•£éœ“è™¹æ•ˆæœ)
2. **ä¸­å±‚**: é”šå­—åŒº (2/3 å®½åº¦, 3Dä¹¦æ³•æ¨¡å‹)
3. **ä¸Šå±‚**: å­—å¹•åŒº (1/3 å®½åº¦, æ»šåŠ¨æ–‡æœ¬)

---

## ğŸ¨ å¼¥æ•£éœ“è™¹é£æ ¼å®ç°æ–¹æ¡ˆ

## ğŸ—ï¸ å¿ƒç»æ–‡æœ¬ç»“æ„

### æ®µè½åˆ†è§£ (åŸºäº1_å¿ƒç»æ‹†è§£.md)
```json
[
  { "id": 1, "text": "ç…§è§äº”è•´çš†ç©ºï¼Œåº¦ä¸€åˆ‡è‹¦å„ã€‚", "anchor": "ç©º" },
  { "id": 2, "text": "è‰²ä¸å¼‚ç©ºï¼Œç©ºä¸å¼‚è‰²ï¼›è‰²å³æ˜¯ç©ºï¼Œç©ºå³æ˜¯è‰²ã€‚", "anchor": "è‰²" },
  { "id": 3, "text": "æ˜¯è¯¸æ³•ç©ºç›¸ï¼šä¸ç”Ÿä¸ç­ï¼Œä¸å¢ä¸å‡€ï¼Œä¸å¢ä¸å‡ã€‚", "anchor": "å¿ƒ" },
  { "id": 4, "text": "æ˜¯æ•…ç©ºä¸­æ— è‰²ï¼Œæ— å—æƒ³è¡Œè¯†ï¼›æ— çœ¼è€³é¼»èˆŒèº«æ„ï¼›æ— è‰²å£°é¦™å‘³è§¦æ³•ï¼›æ— çœ¼ç•Œä¹ƒè‡³æ— æ„è¯†ç•Œã€‚", "anchor": "æ— " },
  { "id": 5, "text": "æ— æ— æ˜ï¼Œäº¦æ— æ— æ˜å°½ã€‚", "anchor": "æ˜" },
  { "id": 6, "text": "ä¹ƒè‡³æ— è€æ­»ï¼Œäº¦æ— è€æ­»å°½ã€‚", "anchor": "è€" },
  { "id": 7, "text": "æ— è‹¦é›†ç­é“ï¼Œæ— æ™ºäº¦æ— å¾—ã€‚", "anchor": "è‹¦" }
]
```

### ğŸ­ å…¨æ–°äº¤äº’è®¾è®¡æ–¹æ¡ˆ

#### **è‡ªåŠ¨æ’­æ”¾ + æ»šåŠ¨æ§åˆ¶ç³»ç»Ÿ**
**æ ¸å¿ƒç†å¿µ**ï¼šå°†æ»šåŠ¨é‡æ–°å®šä¹‰ä¸ºæ’­æ”¾æ§åˆ¶ï¼Œè€Œéä¼ ç»Ÿçš„é¡µé¢æµè§ˆ

**äº¤äº’é€»è¾‘**ï¼š
- **è‡ªåŠ¨æ’­æ”¾**ï¼šé»˜è®¤æŒ‰æ®µè½è‡ªåŠ¨åˆ‡æ¢ï¼Œæ¯æ®µå®Œæˆ1-2åœˆæ—‹è½¬
- **æ»šåŠ¨æ§åˆ¶**ï¼š
  - å‘ä¸‹æ»šåŠ¨ = åŠ é€Ÿæ’­æ”¾
  - å‘ä¸Šæ»šåŠ¨ = å‡é€Ÿæ’­æ”¾
  - å¿«é€Ÿæ»šåŠ¨ = è·³è½¬åˆ°è¿›åº¦æ¡ä½ç½®
  - ä¸æ»šåŠ¨ = æ­£å¸¸æ’­æ”¾é€Ÿåº¦

#### **æ®µè½åˆ‡æ¢åŠ¨ç”»ç³»ç»Ÿ**
**æ—‹è½¬è§„åˆ™**ï¼š
- **çŸ­æ®µè½** (â‰¤30å­—)ï¼š1åœˆæ—‹è½¬ (360Â°)
- **é•¿æ®µè½** (>30å­—)ï¼š2åœˆæ—‹è½¬ (720Â°)
- æ—‹è½¬é€Ÿåº¦æ ¹æ®æ’­æ”¾é€Ÿåº¦åŠ¨æ€è°ƒæ•´

**åˆ‡æ¢åŠ¨ç”»åºåˆ—**ï¼š
1. **ä¸Šæµ®æ¶ˆå¤±** (1ç§’)ï¼šå½“å‰é”šå­— + å­—å¹•åŒæ­¥å‘ä¸Šæ»‘å‡ºè§†é‡
2. **å‘¼å¸åœé¡¿** (0.5ç§’)ï¼šç©ºç™½æœŸï¼Œè¥é€ èŠ‚å¥æ„Ÿ
3. **ä¸‹æ»‘å‡ºç°** (1ç§’)ï¼šæ–°é”šå­—ä»ä¸‹æ–¹æ»‘å…¥ä¸­å¤®ä½ç½®

**æ—¶é—´æ§åˆ¶**ï¼š
```typescript
const segmentDuration = {
  short: 15000,  // çŸ­æ®µè½ 15ç§’
  long: 25000    // é•¿æ®µè½ 25ç§’
}
// å®é™…æ—¶é•¿ = åŸºç¡€æ—¶é•¿ / æ’­æ”¾é€Ÿåº¦
```

#### **æ–‡å­—äº¤æ›¿æ˜¾ç¤ºé€»è¾‘** (ä¿æŒåŸæœ‰è®¾è®¡)
**äº¤é”™å¸ƒå±€åŸåˆ™** (ç›¸å¯¹äºä¸­å¿ƒé”šå­—)ï¼š
- ç¬¬1è¡Œï¼šå‰åŠå¥åœ¨å‰ï¼ŒååŠå¥åœ¨å
- ç¬¬2è¡Œï¼šå‰åŠå¥åœ¨åï¼ŒååŠå¥åœ¨å‰
- ç¬¬3è¡Œï¼šå‰åŠå¥åœ¨å‰ï¼ŒååŠå¥åœ¨å
- ...ä»¥æ­¤ç±»æ¨äº¤é”™è¿›è¡Œ

**æ–‡å­—æ·±åº¦å±‚æ¬¡**ï¼š
- å‰æ–¹æ–‡å­—ï¼šZ=1 (é è¿‘è§‚å¯Ÿè€…)
- é”šå­—æ¨¡å‹ï¼šZ=0 (è§†è§‰ç„¦ç‚¹)
- åæ–¹æ–‡å­—ï¼šZ=-1 (ä½äºæ¨¡å‹åæ–¹)
- é€æ˜åº¦ï¼šå‰æ–¹ 0.9ï¼Œåæ–¹ 0.7 (è¥é€ æ·±åº¦æ„Ÿ)

---

## ğŸš€ æ–°ç‰ˆå®æ–½è®¡åˆ’

### é˜¶æ®µä¸€ï¼šè‡ªåŠ¨æ’­æ”¾æ ¸å¿ƒæ¡†æ¶ (2-3å¤©)

#### 1.1 æ­å»ºæ’­æ”¾æ§åˆ¶ç³»ç»Ÿ

**åˆ›å»ºæ’­æ”¾æ§åˆ¶ Hook**ï¼š
```typescript
// src/hooks/usePlaybackControl.ts
export function usePlaybackControl() {
  const [currentSegmentIndex, setCurrentSegmentIndex] = useState(0)
  const [playbackSpeed, setPlaybackSpeed] = useState(1.0)
  const [isAutoPlaying, setIsAutoPlaying] = useState(true)

  // æ»šåŠ¨å½±å“æ’­æ”¾é€Ÿåº¦
  const { scrollVelocity } = useScrollStore()
  useEffect(() => {
    const newSpeed = Math.max(0.2, Math.min(3.0, 1.0 + scrollVelocity * 0.5))
    setPlaybackSpeed(newSpeed)
  }, [scrollVelocity])

  return { currentSegmentIndex, playbackSpeed, isAutoPlaying }
}
```

#### 1.2 æ®µè½è‡ªåŠ¨åˆ‡æ¢ç³»ç»Ÿ

**æ—¶é—´æ§åˆ¶é€»è¾‘**ï¼š
```typescript
// src/hooks/useSegmentTimer.ts
export function useSegmentTimer() {
  const { currentSegment, playbackSpeed } = usePlaybackControl()

  // æ ¹æ®æ®µè½é•¿åº¦è®¡ç®—åœç•™æ—¶é—´
  const getSegmentDuration = (text: string) => {
    const isLong = text.length > 30
    const baseDuration = isLong ? 25000 : 15000
    return baseDuration / playbackSpeed
  }

  // è‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€æ®µ
  const autoAdvance = () => {
    const duration = getSegmentDuration(currentSegment.text)
    setTimeout(() => {
      setCurrentSegmentIndex(prev => (prev + 1) % heartSutraSegments.length)
    }, duration)
  }
}
```

#### 1.3 ç§»é™¤æ‰‹åŠ¨æ—‹è½¬æ§åˆ¶

**æ¸…ç† OrbitControls**ï¼š
- ä» `AnchorGlyphRegion.tsx` ç§»é™¤ `<OrbitControls>`
- ç¡®ä¿æ¨¡å‹åªèƒ½è‡ªåŠ¨æ—‹è½¬ï¼Œæ— æ³•æ‰‹åŠ¨æ“ä½œ
- ä¿ç•™å¼€å‘æ¨¡å¼ä¸‹çš„è°ƒè¯•åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

### é˜¶æ®µäºŒï¼šæ®µè½åˆ‡æ¢åŠ¨ç”»ç³»ç»Ÿ (2-3å¤©)

#### 2.1 3Dæ¨¡å‹åˆ‡æ¢åŠ¨ç”»

**æ—‹è½¬åŠ¨ç”»æ§åˆ¶**ï¼š
```typescript
// src/components/core/Model3D.tsx å¢å¼º
export default function Model3D({ anchorChar, playbackSpeed }: Model3DProps) {
  const modelRef = useRef<THREE.Group>(null)
  const [rotationProgress, setRotationProgress] = useState(0)

  // è®¡ç®—æ—‹è½¬åœˆæ•°
  const getRotationCycles = (char: string, textLength: number) => {
    return textLength > 30 ? 2 : 1  // é•¿æ®µè½2åœˆï¼ŒçŸ­æ®µè½1åœˆ
  }

  // æ®µè½å†…æŒç»­æ—‹è½¬
  useFrame((state, delta) => {
    if (modelRef.current) {
      const rotationSpeed = (playbackSpeed * delta) / segmentDuration
      modelRef.current.rotation.y += rotationSpeed * Math.PI * 2 * cycles
    }
  })
}
```

#### 2.2 ä¸Šæµ®ä¸‹æ»‘åŠ¨ç”»åºåˆ—

**åˆ‡æ¢åŠ¨ç”»ç»„ä»¶**ï¼š
```typescript
// src/components/animations/SegmentTransition.tsx
export function SegmentTransition({
  currentSegment,
  nextSegment,
  isTransitioning
}: TransitionProps) {

  const transitionSequence = {
    fadeOut: 1000,    // ä¸Šæµ®æ¶ˆå¤±
    pause: 500,       // å‘¼å¸åœé¡¿
    fadeIn: 1000      // ä¸‹æ»‘å‡ºç°
  }

  return (
    <AnimatePresence mode="wait">
      {isTransitioning ? (
        <motion.div
          initial={{ y: 0, opacity: 1 }}
          animate={{ y: -100, opacity: 0 }}
          exit={{ y: 100, opacity: 0 }}
          transition={{ duration: 1.5 }}
        >
          {/* åˆ‡æ¢åŠ¨ç”»å†…å®¹ */}
        </motion.div>
      ) : (
        <motion.div
          initial={{ y: 100, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ duration: 1.0 }}
        >
          {/* å½“å‰æ®µè½å†…å®¹ */}
        </motion.div>
      )}
    </AnimatePresence>
  )
}
```

#### 2.3 å­—å¹•åŒæ­¥åŠ¨ç”»

**ä¸‰å±‚å¸ƒå±€åŠ¨ç”»åè°ƒ**ï¼š
- é”šå­—3Dæ¨¡å‹ï¼šä¸Šæµ®æ¶ˆå¤± + ä¸‹æ»‘å‡ºç°
- å­—å¹•æ–‡æœ¬ï¼šåŒæ­¥ä¸Šæµ®æ¶ˆå¤± + ä¸‹æ»‘å‡ºç°
- èƒŒæ™¯æ•ˆæœï¼šå¹³æ»‘è¿‡æ¸¡ï¼Œä¿æŒè¿ç»­æ€§

### é˜¶æ®µä¸‰ï¼šå¼¥æ•£éœ“è™¹è§†è§‰æ•ˆæœ (2-3å¤©)

**é—®é¢˜**ï¼š`/fonts/chinese-font.woff` 404é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# åˆ›å»ºå­—ä½“ç›®å½•
mkdir -p public/fonts/

# ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ç³»ç»Ÿå­—ä½“fallback
# æ›´æ–° src/app/globals.css
```

```css
/* src/app/globals.css å­—ä½“é…ç½® */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700&display=swap');

html {
  font-family: 'Noto Sans SC', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
}

.chinese-text {
  font-family: 'Noto Sans SC', serif;
  font-weight: 400;
  letter-spacing: 0.1em;
}
```

#### 1.3 å®ç°åŸºç¡€ Shader æè´¨ (é”šå­—æ¨¡å‹)

**ç›®æ ‡**ï¼šä¸ºé”šå­—3Dæ¨¡å‹æ·»åŠ å¼¥æ•£å‘å…‰æ•ˆæœ

```typescript
// src/components/core/Model3D.tsx å¢å¼º
import { useRef, useEffect } from 'react'
import { useFrame } from '@react-three/fiber'
import { useGLTF } from '@react-three/drei'
import * as THREE from 'three'

export default function Model3D() {
  const modelRef = useRef<THREE.Group>(null)
  const { scene } = useGLTF('/models/10k/003_é“.glb')
  
  // åˆ›å»º Matcap æè´¨
  const matcapTexture = new THREE.TextureLoader().load('/textures/matcap-warm.png')
  const matcapMaterial = new THREE.MeshMatcapMaterial({ 
    matcap: matcapTexture,
    transparent: true,
    opacity: 0.9
  })
  
  // åˆ›å»º Fresnel æ•ˆæœæè´¨
  const fresnelMaterial = new THREE.ShaderMaterial({
    uniforms: {
      fresnelPower: { value: 2.0 },
      rimColor: { value: new THREE.Color(0xff6b9d) },
      baseColor: { value: new THREE.Color(0x4ecdc4) }
    },
    vertexShader: `
      varying vec3 vNormal;
      varying vec3 vPosition;
      void main() {
        vNormal = normalize(normalMatrix * normal);
        vPosition = position;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,
    fragmentShader: `
      uniform float fresnelPower;
      uniform vec3 rimColor;
      uniform vec3 baseColor;
      varying vec3 vNormal;
      varying vec3 vPosition;
      
      void main() {
        vec3 viewDirection = normalize(cameraPosition - vPosition);
        float fresnel = 1.0 - max(0.0, dot(vNormal, viewDirection));
        fresnel = pow(fresnel, fresnelPower);
        
        vec3 color = mix(baseColor, rimColor, fresnel);
        gl_FragColor = vec4(color, 0.8);
      }
    `,
    transparent: true
  })
  
  // åº”ç”¨æè´¨åˆ°æ¨¡å‹
  useEffect(() => {
    if (modelRef.current) {
      modelRef.current.traverse((child) => {
        if (child instanceof THREE.Mesh) {
          child.material = fresnelMaterial
        }
      })
    }
  }, [])
  
  return <primitive ref={modelRef} object={scene} />
}
```

#### 1.2 æ·»åŠ åŸºç¡€å…‰ç…§ç³»ç»Ÿ

```typescript
// src/components/core/ScrollCanvas.tsx å…‰ç…§å¢å¼º
<Canvas>
  {/* ç¯å¢ƒå…‰ - æŸ”å’ŒåŸºç¡€ç…§æ˜ */}
  <ambientLight intensity={0.3} color="#ff6b9d" />
  
  {/* ä¸»å…‰æº - æ¸©æš–æ–¹å‘å…‰ */}
  <directionalLight 
    position={[5, 5, 5]} 
    intensity={0.8} 
    color="#ff9a8b"
    castShadow
  />
  
  {/* è¡¥å…‰ - å†·è‰²è°ƒè¡¥å…‰ */}
  <directionalLight 
    position={[-5, -5, -5]} 
    intensity={0.4} 
    color="#4ecdc4"
  />
  
  {/* ç‚¹å…‰æº - åŠ¨æ€å‘¼å¸å…‰ */}
  <pointLight 
    position={[0, 0, 3]} 
    intensity={0.6} 
    color="#ff6b9d"
    distance={10}
  />
</Canvas>
```

### ç¬¬äºŒé˜¶æ®µï¼šä¸‰å±‚å¸ƒå±€æ¶æ„ (3-4å¤©)

**åŸºäºGPTå»ºè®®çš„"ä¸‰å±‚åˆ†ç¦»æ¶æ„"**ï¼šæ ¹æ®å‚è€ƒèµ„æ–™ï¼Œéœ€è¦å®ç°ï¼š
- åº•å±‚ï¼šèƒŒæ™¯WebGLæ¸²æŸ“(å¼¥æ•£éœ“è™¹æ•ˆæœ)
- ä¸­å±‚ï¼šé”šå­—åŒºåŸŸ(2/3å®½åº¦ï¼Œä¹¦æ³•3Dæ¨¡å‹)
- ä¸Šå±‚ï¼šå­—å¹•åŒºåŸŸ(1/3å®½åº¦ï¼Œæ»šåŠ¨æ–‡æœ¬)

è¿™ä¸ªæ¶æ„ç¡®ä¿äº†è§†è§‰å±‚æ¬¡åˆ†æ˜ï¼Œäº¤äº’æµç•…ã€‚

#### 2.1 å®ç°ä¸‰å±‚åˆ†ç¦»å¸ƒå±€

**å¸ƒå±€ç»“æ„**ï¼š
```typescript
// src/components/layout/DreamyLayout.tsx
export default function DreamyLayout() {
  return (
    <div className="relative w-full h-screen overflow-hidden">
      {/* åº•å±‚ï¼šèƒŒæ™¯ WebGL */}
      <div className="absolute inset-0 z-0">
        <BackgroundCanvas />
      </div>

      {/* ä¸­å±‚ï¼šé”šå­—åŒº (2/3 å®½åº¦) */}
      <div className="absolute left-0 top-0 w-2/3 h-full z-10">
        <AnchorGlyphRegion />
      </div>

      {/* ä¸Šå±‚ï¼šå­—å¹•åŒº (1/3 å®½åº¦) */}
      <div className="absolute right-0 top-0 w-1/3 h-full z-20 bg-gradient-to-l from-black/60 to-transparent backdrop-blur-sm">
        <SubtitlesPane />
      </div>

      {/* æ–‡å­—æ·±åº¦å±‚ - å‰æ–¹æ–‡å­— */}
      <div className="absolute left-0 top-0 w-2/3 h-full z-15 pointer-events-none">
        <FrontText className="opacity-90" />
      </div>

      {/* æ–‡å­—æ·±åº¦å±‚ - åæ–¹æ–‡å­— */}
      <div className="absolute left-0 top-0 w-2/3 h-full z-5 pointer-events-none">
        <BackText className="opacity-70" />
      </div>
    </div>
  )
}
```

#### 2.2 æ·»åŠ å¼¥æ•£åæœŸå¤„ç†æ•ˆæœ

**å®ç° Bloom + Film Grain**ï¼š
```typescript
// src/components/core/BackgroundCanvas.tsx
import { EffectComposer, Bloom, Noise } from '@react-three/postprocessing'
import { BlendFunction } from 'postprocessing'

export default function BackgroundCanvas() {
  const { scrollVelocity } = useScrollStore()

  return (
    <Canvas>
      {/* å¼¥æ•£èƒŒæ™¯å‡ ä½• */}
      <DreamyBackground />

      {/* åæœŸå¤„ç†ç®¡çº¿ */}
      <EffectComposer>
        {/* æ ¸å¿ƒ Bloom æ•ˆæœ */}
        <Bloom
          intensity={0.8 + scrollVelocity * 0.4}
          luminanceThreshold={0.15}
          luminanceSmoothing={0.95}
          mipmapBlur={true}
          blendFunction={BlendFunction.SCREEN}
        />

        {/* Film Grain é¢—ç²’è´¨æ„Ÿ */}
        <Noise
          premultiply
          blendFunction={BlendFunction.MULTIPLY}
          opacity={0.3}
        />
      </EffectComposer>
    </Canvas>
  )
}
```

#### 2.2 æ·»åŠ é¢—ç²’è´¨æ„Ÿ (Film Grain)

```typescript
// src/components/core/ScrollCanvas.tsx
import { FilmGrain } from '@react-three/postprocessing'

<EffectComposer>
  <Bloom />
  <FilmGrain
    intensity={0.3}
    opacity={0.1}
  />
</EffectComposer>
```

#### 2.3 æ·»åŠ é›¾åŒ–æ•ˆæœ

```typescript
// src/components/core/ScrollCanvas.tsx
import { Fog } from '@react-three/drei'

<Canvas>
  <fog attach="fog" args={['#ff6b9d', 5, 20]} />
  {/* å…¶ä»–å†…å®¹ */}
</Canvas>
```

### ç¬¬ä¸‰é˜¶æ®µï¼šæ»šåŠ¨é©±åŠ¨æ•ˆæœ (2-3å¤©)

#### 3.1 å¢å¼º useSync Hook

```typescript
// src/hooks/useSync.ts å¢å¼º
import { useScrollStore } from '@/stores/scrollStore'
import { useAudioStore } from '@/stores/audioStore'
import { useEffect } from 'react'

export function useSync() {
  const { scrollVelocity, scrollProgress } = useScrollStore()
  const { setPlaybackRate } = useAudioStore()
  
  useEffect(() => {
    // æ»šåŠ¨é€Ÿåº¦é©±åŠ¨éŸ³é¢‘æ’­æ”¾é€Ÿåº¦
    const playbackRate = 0.5 + scrollVelocity * 0.5 // 0.5x - 1.5x èŒƒå›´
    setPlaybackRate(Math.max(0.5, Math.min(1.5, playbackRate)))
    
    // æ»šåŠ¨è¿›åº¦é©±åŠ¨æ¨¡å‹æ—‹è½¬
    const rotationY = scrollProgress * Math.PI * 2
    // è¿™é‡Œéœ€è¦ä¸ Model3D ç»„ä»¶é€šä¿¡
    
  }, [scrollVelocity, scrollProgress])
}
```

#### 3.2 åŠ¨æ€æè´¨å‚æ•°

```typescript
// src/components/core/Model3D.tsx åŠ¨æ€å‚æ•°
export default function Model3D() {
  const { scrollVelocity } = useScrollStore()
  
  useFrame((state) => {
    if (fresnelMaterial.current) {
      // æ»šåŠ¨é©±åŠ¨ Fresnel å¼ºåº¦
      fresnelMaterial.current.uniforms.fresnelPower.value = 1.5 + scrollVelocity * 1.0
      
      // æ»šåŠ¨é©±åŠ¨å‘å…‰é¢œè‰²
      const intensity = 0.5 + scrollVelocity * 0.5
      fresnelMaterial.current.uniforms.rimColor.value.setHSL(0.9, 0.8, intensity)
    }
  })
}
```

### ç¬¬å››é˜¶æ®µï¼šæ¸å˜è‰²å½©æ˜ å°„ (2å¤©)

#### 4.1 åˆ›å»ºæ¸å˜ LUT çº¹ç†

```typescript
// src/utils/colorGradient.ts
export function createGradientLUT() {
  const canvas = document.createElement('canvas')
  canvas.width = 256
  canvas.height = 1
  const ctx = canvas.getContext('2d')!
  
  const gradient = ctx.createLinearGradient(0, 0, 256, 0)
  gradient.addColorStop(0, '#ff6b9d') // ç²‰æ©™
  gradient.addColorStop(0.5, '#ff9a8b') // è¿‡æ¸¡è‰²
  gradient.addColorStop(1, '#4ecdc4') // é’è“
  
  ctx.fillStyle = gradient
  ctx.fillRect(0, 0, 256, 1)
  
  return new THREE.CanvasTexture(canvas)
}
```

#### 4.2 åº”ç”¨æ¸å˜åˆ°æè´¨

```typescript
// src/components/core/Model3D.tsx
const gradientLUT = createGradientLUT()

const gradientMaterial = new THREE.ShaderMaterial({
  uniforms: {
    gradientMap: { value: gradientLUT },
    scrollProgress: { value: 0 }
  },
  // ... shader ä»£ç 
})
```

---

## ğŸš€ å…·ä½“å®æ–½è®¡åˆ’ (ä¿®è®¢ç‰ˆ)

### ğŸ”¥ ç«‹å³è¡ŒåŠ¨é¡¹ (1-2å¤©) - ä¿®å¤è¿è¡Œé”™è¯¯
- [ ] ä¿®å¤ Tone.js API å¯¼å…¥é”™è¯¯ (useAudio.ts:26,35,44,53)
- [ ] è§£å†³ä¸­æ–‡å­—ä½“æ–‡ä»¶404é”™è¯¯
- [ ] ç¡®è®¤åŸºç¡€é¡µé¢å¯æ­£å¸¸è¿è¡Œ
- [ ] éªŒè¯ä¸‰å±‚å¸ƒå±€æ¶æ„å¯è¡Œæ€§

### ç¬¬1å‘¨ï¼šåŸºç¡€æè´¨å’Œä¸‰å±‚å¸ƒå±€
- [ ] ä¸º `003_é“.glb` æ¨¡å‹æ·»åŠ  Matcap æè´¨
- [ ] å®ç° Fresnel è¾¹ç¼˜å‘å…‰æ•ˆæœ
- [ ] å®ç°ä¸‰å±‚åˆ†ç¦»å¸ƒå±€ (èƒŒæ™¯/é”šå­—/å­—å¹•)
- [ ] æ·»åŠ æ–‡å­—æ·±åº¦å±‚æ¬¡æ˜¾ç¤º (å‰æ–¹/åæ–¹æ–‡å­—)
- [ ] é…ç½®åŸºç¡€å…‰ç…§ç³»ç»Ÿ

### ç¬¬2å‘¨ï¼šå¼¥æ•£å‘å…‰åæœŸå¤„ç†
- [ ] å®ç° Bloom å…‰æ™•æ•ˆæœ (å·²æœ‰ @react-three/postprocessing)
- [ ] æ·»åŠ  Film Grain é¢—ç²’è´¨æ„Ÿ
- [ ] é…ç½®éœ“è™¹æ¸å˜è‰²å½© (ç²‰æ©™â†”é’è“)
- [ ] å®ç°æ»šåŠ¨é©±åŠ¨çš„å…‰æ•ˆå¼ºåº¦å˜åŒ–

### ç¬¬3å‘¨ï¼šå¿ƒç»æ–‡æœ¬äº¤æ›¿é€»è¾‘
- [ ] å®ç°åŸºäºé”šå­—çš„æ–‡æœ¬åˆ†æ®µæ˜¾ç¤º
- [ ] æ·»åŠ å‰åæ–‡å­—äº¤æ›¿é€»è¾‘ (å¥‡å¶è¡Œåè½¬)
- [ ] åŒæ­¥éŸ³é¢‘æ’­æ”¾é€Ÿåº¦ä¸æ»šåŠ¨é€Ÿåº¦
- [ ] æµ‹è¯•æ•´ä½“äº¤äº’æµç•…æ€§

### ç¬¬4å‘¨ï¼šè§†è§‰ä¼˜åŒ–å’Œè®¾å¤‡é€‚é…
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œç§»åŠ¨ç«¯é™çº§æ–¹æ¡ˆ
- [ ] æ·»åŠ å‘¼å¸å…‰æ•ˆ (æ®µè½åˆ‡æ¢æ—¶)
- [ ] æœ€ç»ˆè§†è§‰æ•ˆæœè°ƒä¼˜
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•å’Œä¿®æ­£

---

## ğŸ”§ å…·ä½“å®ç°ç»†èŠ‚

### å¿ƒç»æ–‡æœ¬å®ç°é€»è¾‘

**åŸºäº1_å¿ƒç»æ‹†è§£.mdçš„æ•°æ®ç»“æ„**ï¼š
```typescript
// src/data/heartSutra.ts
export const heartSutraSegments = [
  { id: 1, text: "ç…§è§äº”è•´çš†ç©ºï¼Œåº¦ä¸€åˆ‡è‹¦å„ã€‚", anchor: "ç©º" },
  { id: 2, text: "è‰²ä¸å¼‚ç©ºï¼Œç©ºä¸å¼‚è‰²ï¼›è‰²å³æ˜¯ç©ºï¼Œç©ºå³æ˜¯è‰²ã€‚", anchor: "è‰²" },
  { id: 3, text: "æ˜¯è¯¸æ³•ç©ºç›¸ï¼šä¸ç”Ÿä¸ç­ï¼Œä¸å¢ä¸å‡€ï¼Œä¸å¢ä¸å‡ã€‚", anchor: "å¿ƒ" },
  { id: 4, text: "æ˜¯æ•…ç©ºä¸­æ— è‰²ï¼Œæ— å—æƒ³è¡Œè¯†ï¼›æ— çœ¼è€³é¼»èˆŒèº«æ„ï¼›æ— è‰²å£°é¦™å‘³è§¦æ³•ï¼›æ— çœ¼ç•Œä¹ƒè‡³æ— æ„è¯†ç•Œã€‚", anchor: "æ— " },
  { id: 5, text: "æ— æ— æ˜ï¼Œäº¦æ— æ— æ˜å°½ã€‚", anchor: "æ˜" },
  { id: 6, text: "ä¹ƒè‡³æ— è€æ­»ï¼Œäº¦æ— è€æ­»å°½ã€‚", anchor: "è€" },
  { id: 7, text: "æ— è‹¦é›†ç­é“ï¼Œæ— æ™ºäº¦æ— å¾—ã€‚", anchor: "è‹¦" }
]

// æ–‡æœ¬åˆ†å‰²é€»è¾‘
export function splitTextByAnchor(text: string, anchor: string) {
  const anchorIndex = text.indexOf(anchor)
  if (anchorIndex === -1) return { front: text, back: '' }

  return {
    front: text.substring(0, anchorIndex),
    back: text.substring(anchorIndex + anchor.length)
  }
}

// äº¤æ›¿æ˜¾ç¤ºé€»è¾‘
export function getTextLayout(segmentId: number) {
  const isEven = segmentId % 2 === 0
  return {
    frontZ: isEven ? -1 : 1,  // å¶æ•°è¡Œï¼šå‰æ–‡åœ¨åï¼Œå¥‡æ•°è¡Œï¼šå‰æ–‡åœ¨å‰
    backZ: isEven ? 1 : -1,   // å¶æ•°è¡Œï¼šåæ–‡åœ¨å‰ï¼Œå¥‡æ•°è¡Œï¼šåæ–‡åœ¨å
    frontOpacity: isEven ? 0.7 : 0.9,
    backOpacity: isEven ? 0.9 : 0.7
  }
}
```

### ä¸‰å±‚å“åº”å¼å¸ƒå±€å®ç°

```typescript
// src/components/layout/ResponsiveLayout.tsx
export default function ResponsiveLayout() {
  const [isMobile, setIsMobile] = useState(false)

  useEffect(() => {
    const checkMobile = () => setIsMobile(window.innerWidth < 768)
    checkMobile()
    window.addEventListener('resize', checkMobile)
    return () => window.removeEventListener('resize', checkMobile)
  }, [])

  if (isMobile) {
    return (
      <div className="flex flex-col h-screen">
        {/* ç§»åŠ¨ç«¯ï¼šä¸Šä¸‹å †å  */}
        <div className="flex-1 relative">
          <BackgroundCanvas />
          <AnchorGlyphRegion />
        </div>
        <div className="h-1/3 bg-black/60">
          <SubtitlesPane />
        </div>
      </div>
    )
  }

  return (
    <div className="relative w-full h-screen overflow-hidden">
      {/* æ¡Œé¢ç«¯ï¼šå·¦å³åˆ†ç¦» */}
      <div className="absolute inset-0 z-0">
        <BackgroundCanvas />
      </div>
      <div className="absolute left-0 top-0 w-2/3 h-full z-10">
        <AnchorGlyphRegion />
      </div>
      <div className="absolute right-0 top-0 w-1/3 h-full z-20">
        <SubtitlesPane />
      </div>
    </div>
  )
}
```

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### ç§»åŠ¨ç«¯é™çº§æ–¹æ¡ˆ
```typescript
// src/utils/deviceDetection.ts
export function getDeviceCapabilities() {
  const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
  const isLowEnd = navigator.hardwareConcurrency < 4
  
  return {
    enableBloom: !isMobile && !isLowEnd,
    enableGrain: !isLowEnd,
    particleCount: isMobile ? 1000 : 10000,
    bloomIterations: isMobile ? 1 : 3
  }
}
```

### æ¸²æŸ“æ€§èƒ½ç›‘æ§
```typescript
// src/hooks/usePerformance.ts
export function usePerformance() {
  const [fps, setFps] = useState(60)
  
  useFrame(() => {
    // ç›‘æ§å¸§ç‡
    const now = performance.now()
    const delta = now - lastTime
    setFps(1000 / delta)
    lastTime = now
    
    // è‡ªåŠ¨é™çº§
    if (fps < 30) {
      // é™ä½æ•ˆæœè´¨é‡
    }
  })
}
```

---

## ğŸ“± å“åº”å¼å¸ƒå±€è°ƒæ•´

### æ¡Œé¢ç«¯ (â‰¥1024px)
- é”šå­—åŒºï¼š60% å®½åº¦
- å­—å¹•åŒºï¼š40% å®½åº¦
- å®Œæ•´åæœŸå¤„ç†æ•ˆæœ

### å¹³æ¿ç«¯ (768px - 1024px)
- é”šå­—åŒºï¼š50% å®½åº¦
- å­—å¹•åŒºï¼š50% å®½åº¦
- ä¸­ç­‰åæœŸå¤„ç†æ•ˆæœ

### ç§»åŠ¨ç«¯ (â‰¤768px)
- çºµå‘å †å å¸ƒå±€
- é”šå­—åŒºåœ¨ä¸Šæ–¹
- å­—å¹•åŒºåœ¨ä¸‹æ–¹
- åŸºç¡€åæœŸå¤„ç†æ•ˆæœ

---

## ğŸ”§ å¼€å‘å·¥å…·å’Œè°ƒè¯•

### æ€§èƒ½ç›‘æ§é¢æ¿
```typescript
// src/components/debug/PerformancePanel.tsx
export function PerformancePanel() {
  const { fps, memory } = usePerformance()
  
  return (
    <div className="fixed top-4 right-4 bg-black/50 text-white p-2 rounded">
      <div>FPS: {fps}</div>
      <div>Memory: {memory}MB</div>
    </div>
  )
}
```

### æè´¨å‚æ•°è°ƒè¯•
```typescript
// src/components/debug/MaterialDebugger.tsx
export function MaterialDebugger() {
  const [fresnelPower, setFresnelPower] = useState(2.0)
  const [bloomIntensity, setBloomIntensity] = useState(0.5)
  
  return (
    <div className="fixed bottom-4 left-4 bg-black/50 text-white p-4 rounded">
      <div>
        <label>Fresnel Power: {fresnelPower}</label>
        <input 
          type="range" 
          min="0" 
          max="5" 
          step="0.1"
          value={fresnelPower}
          onChange={(e) => setFresnelPower(Number(e.target.value))}
        />
      </div>
      {/* æ›´å¤šè°ƒè¯•æ§ä»¶ */}
    </div>
  )
}
```

---

## ğŸ“‹ éªŒæ”¶æ ‡å‡†

### è§†è§‰æ•ˆæœéªŒæ”¶
- [ ] æ¨¡å‹å…·æœ‰æŸ”å’Œçš„è¾¹ç¼˜å‘å…‰æ•ˆæœ
- [ ] æ»šåŠ¨æ—¶æè´¨å‚æ•°åŠ¨æ€å˜åŒ–
- [ ] Bloom å…‰æ™•æ•ˆæœè‡ªç„¶
- [ ] é¢—ç²’è´¨æ„Ÿé€‚ä¸­ï¼Œä¸è¿‡åº¦
- [ ] æ¸å˜è‰²å½©è¿‡æ¸¡å¹³æ»‘

### æ€§èƒ½éªŒæ”¶
- [ ] æ¡Œé¢ç«¯ä¿æŒ 60fps
- [ ] ç§»åŠ¨ç«¯ä¿æŒ 45fps ä»¥ä¸Š
- [ ] å†…å­˜ä½¿ç”¨åˆç† (<200MB)
- [ ] åŠ è½½æ—¶é—´ <3ç§’

### äº¤äº’éªŒæ”¶
- [ ] æ»šåŠ¨å“åº”å»¶è¿Ÿ <100ms
- [ ] éŸ³é¢‘åŒæ­¥ç²¾åº¦ <200ms
- [ ] è§†è§‰æ•ˆæœä¸æ»šåŠ¨é€Ÿåº¦åŒ¹é…
- [ ] æ®µè½åˆ‡æ¢æ—¶çš„å‘¼å¸æ•ˆæœ

---

## ğŸ‰ é¢„æœŸæ•ˆæœ

å®ç°å®Œæˆåï¼ŒCoScroll å°†å‘ˆç°ï¼š

1. **ç©ºçµè´¨æ„Ÿ**ï¼šæ¨¡å‹å…·æœ‰æŸ”å’Œçš„å‘å…‰è¾¹ç¼˜ï¼Œä»¿ä½›ç”±å…‰çº¿æ„æˆ
2. **åŠ¨æ€å“åº”**ï¼šæ»šåŠ¨æ—¶æè´¨ã€å…‰ç…§ã€åæœŸæ•ˆæœå®æ—¶å˜åŒ–
3. **é¢—ç²’è´¨æ„Ÿ**ï¼šæ•´ä½“ç”»é¢å…·æœ‰èƒ¶ç‰‡é¢—ç²’æ„Ÿï¼Œå¢åŠ è‰ºæœ¯æ°›å›´
4. **è‰²å½©æ¸å˜**ï¼šä»ç²‰æ©™åˆ°é’è“çš„å¹³æ»‘è‰²å½©è¿‡æ¸¡
5. **æ€§èƒ½ç¨³å®š**ï¼šåœ¨å„ç§è®¾å¤‡ä¸Šéƒ½èƒ½æµç•…è¿è¡Œ

è¿™ä¸ªå®ç°æ–¹æ¡ˆå®Œå…¨åŸºäºæ‚¨ç°æœ‰çš„ MVP æ¶æ„ï¼Œæ•´åˆäº†ï¼š
- **å¿ƒç»æ‹†è§£æ•°æ®** (1_å¿ƒç»æ‹†è§£.md)
- **GPTé£æ ¼å»ºè®®** (ä¸‰å±‚åˆ†ç¦»æ¶æ„)
- **æµè§ˆå™¨é”™è¯¯æ—¥å¿—** (Tone.jså’Œå­—ä½“é—®é¢˜)
- **ç”¨æˆ·åé¦ˆè¦æ±‚** (ç¡®è®¤è®¾è®¡ã€æ ‡è®°å®ŒæˆçŠ¶æ€)

åªéœ€è¦åœ¨ç°æœ‰ç»„ä»¶åŸºç¡€ä¸Šè¿›è¡Œå¢å¼ºï¼Œä¸ä¼šç ´åå·²æœ‰çš„åŠŸèƒ½ç»“æ„ã€‚

---

## âš¡ ç´§æ€¥ä¿®å¤æ¸…å•

### å¿…é¡»ç«‹å³è§£å†³çš„é—®é¢˜
1. **Tone.js APIé”™è¯¯** (`src/hooks/useAudio.ts`)
   - ä¿®å¤ `tone.start` â†’ `Tone.start()`
   - ä¿®å¤ `tone.context` â†’ `Tone.getContext()`
   - ä¿®å¤ `tone.Reverb` â†’ `new Tone.Reverb()`
   - ä¿®å¤ `tone.Player` â†’ `new Tone.Player()`

2. **å­—ä½“æ–‡ä»¶404é”™è¯¯**
   - æ·»åŠ  Google Fonts fallback
   - é…ç½®ä¸­æ–‡å­—ä½“æ ˆ
   - ç¡®ä¿æ–‡å­—æ­£å¸¸æ˜¾ç¤º

3. **TODOçŠ¶æ€ç®¡ç†**
   - åŠæ—¶æ ‡è®°å·²å®Œæˆä»»åŠ¡ä¸º âœ…
   - è·Ÿè¸ªå½“å‰è¿›åº¦çŠ¶æ€
   - ç¡®ä¿é¡¹ç›®é‡Œç¨‹ç¢‘å¯è§

### éªŒè¯è¦æ±‚
å®Œæˆä¿®å¤åï¼Œåº”èƒ½çœ‹åˆ°ï¼š
- âœ… å¼€å‘æœåŠ¡å™¨æ— é”™è¯¯è¿è¡Œ
- âœ… ä¸­æ–‡å­—ç¬¦æ­£å¸¸æ˜¾ç¤º
- âœ… éŸ³é¢‘ç³»ç»Ÿæ­£å¸¸åˆå§‹åŒ–
- âœ… ä¸‰å±‚å¸ƒå±€åŸºç¡€æ¶æ„å¯è§

---

> **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼š
> 1. **ç«‹å³ä¿®å¤**ï¼šè§£å†³ Tone.js å’Œå­—ä½“é”™è¯¯
> 2. **ç¡®è®¤è®¾è®¡**ï¼šä¸ä½ ç¡®è®¤èƒŒæ™¯ã€æ–‡å­—ã€é€‰æ®µçš„å…·ä½“å®ç°æ–¹æ¡ˆ
> 3. **å¼€å§‹å¼€å‘**ï¼šåŸºäºç¡®è®¤çš„è®¾è®¡å¼€å§‹å¼¥æ•£éœ“è™¹é£æ ¼å®ç°
> 4. **è¿­ä»£ä¼˜åŒ–**ï¼šé€æ­¥æ·»åŠ åæœŸå¤„ç†æ•ˆæœå’Œäº¤äº’é€»è¾‘
>
> **é‡è¦**ï¼šæ¯å®Œæˆä¸€ä¸ªé˜¶æ®µéƒ½ä¼šåŠæ—¶æ›´æ–°TODOçŠ¶æ€ï¼Œç¡®ä¿è¿›åº¦é€æ˜å¯æ§ã€‚
